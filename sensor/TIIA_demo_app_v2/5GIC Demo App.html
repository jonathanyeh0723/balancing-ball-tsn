<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>TSN Demp</title>
  <meta name="generator" content="Google Web Designer 14.0.2.0928">
  <style type="text/css" id="gwd-text-style">
    p {
      margin: 0px;
    }
    h1 {
      margin: 0px;
    }
    h2 {
      margin: 0px;
    }
    h3 {
      margin: 0px;
    }
  </style>
  <style type="text/css">
    html, body {
      width: 100%;
      height: 100%;
      margin: 0px;
    }
    body {
      background-color: transparent;
      transform: perspective(1400px) matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      transform-style: preserve-3d;
    }
    .gwd-div-bs57 {
      position: absolute;
      width: 858px;
      height: 458px;
      background-image: none;
      background-color: transparent;
      border-image-source: none;
      border-image-width: 1;
      border-image-outset: 0;
      border-image-repeat: stretch;
      border-color: rgb(0, 0, 0);
      top: 133px;
      left: 15px;
    }
    .gwd-rect-1xdv {
      background-color: rgb(238, 244, 250);
      border-block-style: solid;
      border-block-width: 1.6px;
      border-color: rgb(124, 161, 197);
      border-radius: 10px;
      border-style: solid;
      border-width: 1.6px;
      border-inline-style: solid;
      border-inline-width: 1.6px;
      box-sizing: border-box;
      display: block;
      height: 135px;
      position: absolute;
      width: 154px;
      left: 51px;
      top: 184px;
    }
    .gwd-span-s5ce {
      color: rgb(42, 80, 117);
      display: block;
      font-family: Arial;
      font-size: 25px;
      font-weight: 700;
      position: absolute;
      left: 1000px;
      top: 123px;
    }
    .gwd-rect-17uf {
      position: absolute;
      width: 1194px;
      box-sizing: border-box;
      border-style: solid;
      background-image: none;
      border-width: 0px;
      border-image-source: none;
      border-image-width: 1;
      border-image-outset: 0;
      border-image-repeat: stretch;
      border-color: rgb(217, 238, 255);
      background-color: rgb(16, 83, 137);
      left: 0px;
      top: 0px;
      height: 66px;
    }
    .gwd-img-1hyp {
      position: absolute;
      height: 58px;
      transform-origin: 50% 50% 0px;
      width: 142px;
      left: 15px;
      top: 4px;
    }
    .gwd-svg-15l7 {
      transform-origin: 50% 50% 0px;
      border-width: 1px;
      border-image-source: none;
      border-image-width: 1;
      border-image-outset: 0;
      border-image-repeat: stretch;
      border-color: rgb(1, 43, 83);
      background-image: none;
      background-color: transparent;
      left: 15px;
      top: 113px;
      width: 912px;
      height: 478px;
    }
    .gwd-svg-wt7h {
      height: 94px;
      transform-origin: 50% 50% 0px;
      left: 939px;
      top: 152px;
      width: 235px;
    }
    .gwd-img-jdlp {
      position: absolute;
      transform-origin: 50% 50% 0px;
      width: 100px;
      height: 100px;
      top: 73px;
      left: 915px;
    }
    .gwd-svg-eraf {
      height: 31px;
      left: 0px;
      top: 695px;
    }
    .gwd-svg-1bdb {
      height: 10px;
      background-color: rgb(70, 145, 206);
      top: 66px;
      left: -1px;
    }
    .gwd-span-1h8m {
      font-size: 15px;
      left: 15px;
      transform-origin: 50.4375px 8.8px 0px;
      top: 95px;
    }
    .gwd-svg-nsoa {
      left: -1px;
      top: 695px;
    }
    .line {
      fill: none;
      stroke: rgb(255, 171, 0);
      stroke-width: 3;
    }
    .overlay {
      fill: none;
      pointer-events: all;
    }
    .dot {
      fill: rgb(255, 171, 0);
      stroke: rgb(255, 255, 255);
    }
    .focus circle {
      fill: none;
      stroke: steelblue;
    }
    .gwd-p-ulis {
      position: absolute;
      width: 183.05px;
      height: 58px;
      text-align: left;
      font-size: 35px;
      font-family: Tahoma;
      color: rgb(10, 59, 99);
      left: 965px;
      top: 173px;
    }
    .gwd-span-1f3f {
      width: 172px;
      left: 991px;
      top: 113px;
    }
    .gwd-span-1u1n {
      position: absolute;
      font-family: Arial;
      font-size: 25px;
      color: rgb(42, 80, 117);
      left: 1137px;
      top: 217px;
      font-weight: normal;
    }
    .gwd-p-183a {
      color: rgb(45, 125, 194);
      font-family: Arial;
      font-weight: 700;
      position: absolute;
      left: 157px;
      top: 24px;
    }
    .gwd-svg-203a {
      top: 310px;
    }
    .gwd-span-kc9u {
      top: 271px;
    }
    .gwd-img-4cb0 {
      top: 231px;
    }
    .gwd-p-1mt1 {
      top: 331px;
    }
    .gwd-span-whww {
      top: 375px;
    }
    .gwd-svg-xi8v {
      top: 483px;
    }
    .gwd-span-12fh {
      top: 444px;
    }
    .gwd-img-1tdy {
      top: 404px;
    }
    .gwd-p-sdb2 {
      top: 504px;
    }
    .gwd-span-1lrh {
      top: 548px;
    }
  </style>
  <script src="./js/jquery-3.5.1.min.js"></script>
  <script src="./js/d3.v5.min.js"></script>
  <script>
    var minY = -1
    var maxY = -1

    $(document).ready(function() {
      var timer = setInterval(postPropertyValues, 1000);
      var counter = 0;


    });

    function update_label(in_data) {
      obj = in_data
      $("#avg_latency_label").html(obj.avg_latency_val);
    }


    function postPropertyValues() {
      var api_URL = "http://localhost:5000";
      var request_obj = new Request('latency');
      var api_URL = request_obj.url.replace('/latency', ':5000/latency');
      //console.log(api_URL)

      $.ajax({
        crossDomain: true,
        type: "GET",
        dataType: 'json',
        async: false,
        url: api_URL,
        success: function(data) {
          //console.log(data)
          update_line_chart(data, 500);
          update_label(data, 500);
        }
      });

    }


    function update_label(in_data, unit_convert) {
      var obj = in_data
      avg_val = (obj.avg_latency_val * unit_convert).toString();
      max_val = (obj.max_latency_val * unit_convert).toString();
      min_val = (obj.min_latency_val * unit_convert).toString();
      $("#avg_latency_label").html(avg_val.substr(0, 9));
      $("#max_latency_label").html(max_val.substr(0, 9));
      $("#min_latency_label").html(min_val.substr(0, 9));
      //console.log(avg_val, max_val, min_val)
    }

    function update_line_chart(in_data, unit_convert) {

      // 2. Use the margin convention practice 
      var margin = {
          top: 50,
          right: 50,
          bottom: 50,
          left: 80
        },
        width = 800 // Use the window's width 
        ,
        height = 300 // Use the window's height

      //console.log(in_data)
      var obj = in_data

      val_list = obj.latency_list.replace("[", "").replace("]", "").split(",")
      var new_onj_list = new Array();

      for (let i = 0; i < val_list.length; i++) {
        new_onj_list[i] = {
          y: val_list[i] * unit_convert
        }

      }
      //console.log(new_onj_list)

      var dataset = new_onj_list

      // 5. X scale will use the index of our data
      var xScale = d3.scaleLinear()
        .domain([0, val_list.length-1]) // input
        .range([0, width]); // output

      //var minY = d3.min(dataset, function(d){return d.y });
      minY = d3.min(dataset, function(d) {
        return d.y
      }) - d3.min(dataset, function(d) {
        return d.y
      }) / 1000;

      maxY = d3.max(dataset, function(d) {
        return d.y
      }) + d3.max(dataset, function(d) {
        return d.y
      }) / 1000;

      var yScale = d3.scaleLinear()
        .domain([minY, maxY]) // input 
        .range([height, 0]); // output 

      // 7. d3's line generator
      var line = d3.line()
        .x(function(d, i) {
          return xScale(i);
        }) // set the x values for the line generator
        .y(function(d) {
          return yScale(d.y);
        }) // set the y values for the line generator 
        .curve(d3.curveMonotoneX) // apply smoothing to the line



      // 1. Add the SVG to the page and employ #2
      d3.select("#chart_div").selectAll("*").remove();
      var svg = d3.select("#chart_div").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


      // 3. Call the x axis in a group tag
      svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(xScale)); // Create an axis component with d3.axisBottom

      // 4. Call the y axis in a group tag
      svg.append("g")
        .attr("class", "y axis")
        .call(d3.axisLeft(yScale)); // Create an axis component with d3.axisLeft

      svg.append("path")
        .datum(dataset) // 10. Binds data to the line 
        .attr("class", "line") // Assign a class for styling 
        .attr("d", line); // 11. Calls the line generator 


      svg.selectAll(".dot")
        .data(dataset)
        .enter().append("circle") // Uses the enter().append() method
        .attr("class", "dot") // Assign a class for styling
        .attr("cx", function(d, i) {
          return xScale(i)
        })
        .attr("cy", function(d) {
          return yScale(d.y)
        })
        .attr("r", 5)
    }
  </script>
</head>

<body class="htmlNoPages">
  <svg data-gwd-shape="rectangle" class="gwd-rect-1xdv gwd-svg-1ddy gwd-svg-1otz gwd-svg-y25s gwd-svg-1cwf gwd-svg-1a85 gwd-svg-15l7"></svg>
  <svg data-gwd-shape="rectangle" class="gwd-rect-17uf" data-gwd-guide=""></svg>
  <svg data-gwd-shape="rectangle" class="gwd-rect-17uf gwd-svg-eraf gwd-svg-nsoa" data-gwd-guide=""></svg>
  <div class="gwd-div-bs57" id="chart_div"></div>
  <svg data-gwd-shape="rectangle" class="gwd-rect-1xdv gwd-svg-1ddy gwd-svg-1otz gwd-svg-y25s gwd-svg-1cwf gwd-svg-1a85 gwd-svg-wt7h"></svg>
  <span class="gwd-span-s5ce gwd-span-1n2h gwd-span-1f3f">Avg. Latency</span>
  <img src="assets/image_3.png" class="gwd-img-1hyp">
  <img src="assets/Intel_performance_Efficient-Performance_1500x1500_light_RGB.png" class="gwd-img-jdlp">
  <span class="gwd-span-s5ce gwd-span-1n2h gwd-span-1h8m"> Latency Realtime Chart </span>
  <p class="gwd-p-ulis" id="avg_latency_label"></p>
  <span class="gwd-span-1u1n">ms</span>
  <svg data-gwd-shape="rectangle" class="gwd-rect-1xdv gwd-svg-1ddy gwd-svg-1otz gwd-svg-y25s gwd-svg-1cwf gwd-svg-1a85 gwd-svg-wt7h gwd-svg-xi8v"></svg><span class="gwd-span-s5ce gwd-span-1n2h gwd-span-1f3f gwd-span-12fh">Min. Latency</span>
  <img src="assets/Intel_performance_Efficient-Performance_1500x1500_light_RGB.png" class="gwd-img-jdlp gwd-img-1tdy">
  <p class="gwd-p-ulis gwd-p-sdb2" id="min_latency_label"></p><span class="gwd-span-1u1n gwd-span-1lrh">ms</span>
  <svg data-gwd-shape="rectangle" class="gwd-rect-1xdv gwd-svg-1ddy gwd-svg-1otz gwd-svg-y25s gwd-svg-1cwf gwd-svg-1a85 gwd-svg-wt7h gwd-svg-203a"></svg><span class="gwd-span-s5ce gwd-span-1n2h gwd-span-1f3f gwd-span-kc9u">Max. Latency</span>
  <img src="assets/Intel_performance_Efficient-Performance_1500x1500_light_RGB.png" class="gwd-img-jdlp gwd-img-4cb0">
  <p class="gwd-p-ulis gwd-p-1mt1" id="max_latency_label"></p><span class="gwd-span-1u1n gwd-span-whww">ms</span>
  <p class="gwd-p-183a">Power by IOTG-ICE</p>
</body>

</html>